\clearpage

\section*{Coverage}

A \textit{(coverage) goal} or \textit{pattern} is a term (object or type) $U$ containing free variables such that $\hasKind{\ctx}{U}{V}$.
It represents the collection of ground terms given by instantiating the variables in $\ctx$.
% More formally, a pattern is triple $\tup{\ctx, U, V}$ such that $\hasKind{\ctx}{U}{V}$, but ...

We say a coverage goal $\hasKind{\ctx}{U}{V}$ is \textit{immediately covered} by a pattern $\hasKind{\ctx'}{U'}{V'}$ if there exists a substitution $\subHasCtx{\ctx}{\sub}{\ctx'}$ such that $\defeq{U}{\subst{U'}{\sub}}$ and $\defeq{V}{\subst{V'}{\sub}}$.
It is immediately covered by a finite set of patterns if it is immediately covered by a member of the set.

A goal $\hasKind{\ctx}{U}{V}$ is then \textit{covered} by a set of patterns $\P$ if, for all substitutions $\subHasCtx{\nil}{\sub}{\ctx}$, the goal $\hasKind{\nil}{\subst{U}{\sub}}{\subst{V}{\sub}}$ is immediately covered by $\P$.
That is, a goal is covered if every ground instance of the goal is immediately covered.

\begin{theorem}[Conservativity of coverage]
Let $\hasKind{\ctx}{U}{V}$ be a coverage goal, $\S = \set{\subHasCtx{\ctx_i}{\sub_i}{\ctx} \;\;|\;\; i = 1, ..., n}$ a non-redundant, complete set of substitutions, and $\P$ a set of patterns.
Then $\hasKind{\ctx}{U}{V}$ is covered by $\P$ if and only if all members of $\set{\hasKind{\ctx_i}{\subst{U}{\sub_i}}{\subst{V}{\sub_i}} \;\;|\;\; i = 1, ..., n}$ are covered by $\P$.
\end{theorem}

\begin{proof}
Coverage depends only on the set of ground instances of the goal.
But since $\S$ is complete, the set of ground instances of $\hasKind{\ctx}{U}{V}$ is exactly the same as the union of the sets of ground instances of $\hasKind{\ctx_i}{\subst{U}{\sub_i}}{\subst{V}{\sub_i}}$ for each $i$.
\end{proof}

Given a goal $\hasKind{\ctx}{U}{V}$ with $\ctx = (\ctx_1, \typing{x}{P_x}, \ctx_2)$, we can \textit{split} it on the variable $x$ to yield the following set of \textit{splitting} substitutions:
\begin{align*}
\set{
  \subHasCtx{\ctx'}{\sub}{\ctx} \;\;|\;\; & (\typing{c}{\pi{\ctx_c}{P_c}}) \in \sig, \\ % consider doing \sub_|_{\ctx}, i.e. sub restricted to ctx
  & \sub \; \text{is a mgu of} \; \set{P_x \approx P_c, x \approx \app{c}{\ctx_c}}, \\
  & \subHasCtx{\ctx'}{\sub}{(\ctx, \ctx_c)}
}
\end{align*}

Crucially, a goal $\hasKind{\ctx}{U}{V}$ and the set of goals $\set{\hasKind{\ctx_i}{\subst{U}{\sub_i}}{\subst{V}{\sub_i}} \;\;|\;\; i = 1, ..., n}$, given by applying a splitting set $\set{\subHasCtx{\ctx_i}{\sub_i}{\ctx} \;\;|\;\; i = 1, ..., n}$ to the goal, represent the same set of ground terms.
This is an immediate corollary of the following theorem.

\begin{theorem}[Splitting is non-redundant and complete]
\label{thm:splitting-props}
The set of substitutions generated by splitting is non-redundant and complete.
\end{theorem}

\begin{proof}
Suppose $\S$ is the result of splitting $\hasKind{(\ctx_1, \typing{x}{P_x}, \ctx_2)}{U}{V}$ on $x$.

By definition of splitting, each $\sub \in \S$ in particular maps $x$ to a term with a unique head constant.
Hence $\S$ is non-redundant.

By [clever argument, using properties of most general unifiers], $\S$ is also complete.
\end{proof}

Hence a coverage goal is covered by a set of patterns if and only if the goals resulting from splitting the goal (on any variable) are all covered.
